# âš™ï¸ **Jenkins Setup on GCP VM using Docker-in-Docker (DinD) â€” LLMOps StudyBuddy**

In this stage, you will set up **Jenkins** on your **Google Cloud Platform (GCP) Virtual Machine** using a **Docker-in-Docker (DinD)** configuration.
This allows Jenkins to run inside a Docker container while still having access to the host machineâ€™s Docker daemon, enabling full CI/CD capabilities for the **LLMOps StudyBuddy** project.

## ğŸ§© 1ï¸âƒ£ Ensure Jenkins Runs on the Same Network as Minikube

Run:

```bash
docker run -d --name jenkins \
  -p 8080:8080 \
  -p 50000:50000 \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v $(which docker):/usr/bin/docker \
  -u root \
  -e DOCKER_GID=$(getent group docker | cut -d: -f3) \
  --network minikube \
  jenkins/jenkins:lts
```

Check:

```bash
docker ps
```

## ğŸ§  2ï¸âƒ£ Retrieve the Jenkins Admin Password

```bash
docker logs jenkins
```

Copy the autogenerated admin password.

## ğŸŒ 3ï¸âƒ£ Access Jenkins in the Browser

Navigate to:

```
http://<YOUR_VM_EXTERNAL_IP>:8080
```

<p align="center">
  <img src="img/jenkins/admin_login.png" alt="Jenkins Admin Login" width="100%">
</p>

## ğŸ§© 4ï¸âƒ£ Install Plugins and Create Admin User

Install suggested plugins:

<p align="center">
  <img src="img/jenkins/install_plugins.png" alt="Install Plugins" width="100%">
</p>

Create admin user:

<p align="center">
  <img src="img/jenkins/create_admin_user.png" alt="Create Admin User" width="100%">
</p>

Jenkins dashboard:

<p align="center">
  <img src="img/jenkins/jenkins_dashboard.png" alt="Jenkins Dashboard" width="100%">
</p>

## ğŸ”§ 5ï¸âƒ£ Install Required Jenkins Plugins

From **Manage Jenkins â†’ Plugins**, install:

* Docker
* Docker Pipeline

<p align="center">
  <img src="img/jenkins/install_docker_plugins.png" alt="Docker Plugins" width="100%">
</p>

Then install:

* Kubernetes

<p align="center">
  <img src="img/jenkins/install_kubernetes_plugin.png" alt="Install Kubernetes Plugin" width="100%">
</p>

## ğŸ” 6ï¸âƒ£ Restart Jenkins

```bash
docker restart jenkins
```

## ğŸ§± 7ï¸âƒ£ Set Up Python Inside Jenkins Container

```bash
docker exec -it jenkins bash
apt update -y
apt install -y python3 python3-pip python3-venv
ln -s /usr/bin/python3 /usr/bin/python
exit
docker restart jenkins
```

## ğŸ” 8ï¸âƒ£ Add GitHub Credentials in Jenkins

Go to **Manage Jenkins â†’ Credentials â†’ (global)**.

<p align="center">
  <img src="img/github_int/add_credential.png" alt="Add Credential" width="100%">
</p>

Add credentials:

* Username: GitHub username
* Password: **GitHub Personal Access Token**
* ID: `github-token`

<p align="center">
  <img src="img/github_int/new_credential.png" alt="New GitHub Credential" width="100%">
</p>

## ğŸš€ 9ï¸âƒ£ Create a New Jenkins Pipeline

Create a pipeline named:

```
GITOPS PROJECT
```

<p align="center">
  <img src="img/github_int/new_item.png" alt="Create New Pipeline Item" width="100%">
</p>

## ğŸ§  1ï¸âƒ£0ï¸âƒ£ Configure Pipeline to Use GitHub

Pipeline script from SCM â†’ Git â†’ paste repo URL â†’ select `github-token` â†’ set branch:

```
*/main
```

<p align="center">
  <img src="img/github_int/item_config.png" alt="Pipeline SCM Config" width="100%">
</p>

## ğŸ§© 1ï¸âƒ£1ï¸âƒ£ Generate Jenkins Pipeline Script

Go to **Pipeline Syntax** and generate:

```
checkout: Check out from version control
```

Copy the generated Groovy block for later use in the Jenkinsfile.

## ğŸ§¾ 1ï¸âƒ£2ï¸âƒ£ Create Jenkinsfile and Test Pipeline

Inside your project directory:

### Create a **Jenkinsfile**:

Include the full file (you can paste your own or ask me to generate one).
For now, **comment out all stages except the first one** (testing purposes).

Replace:

```
checkout scmGit(branches: â€¦
```

with the **Pipeline Syntax checkout script** generated in the previous step.

Save the file and push to GitHub:

```bash
git add Jenkinsfile
git commit -m "Added Jenkinsfile"
git push
```

On your VM:

```bash
git pull
```

Run your pipeline:

* Jenkins Dashboard â†’ your pipeline â†’ **Build Now**

You should see a green tick:

<p align="center">
  <img src="img/jenkins/jenkins_build.png" alt="Successful Jenkins Build" width="100%">
</p>

## ğŸ³ 1ï¸âƒ£3ï¸âƒ£ Configure Docker in Jenkins

Go to:

**Manage Jenkins â†’ Tools**

Scroll to bottom â†’ click **+ Add Docker**.

* Name: `Docker`
* Install automatically
* Add installer â†’ **Download from docker.com**

<p align="center">
  <img src="img/jenkins/jenkins_docker_install.png" alt="Jenkins Docker Install" width="100%">
</p>

Apply and Save.

## ğŸ™ 1ï¸âƒ£4ï¸âƒ£ Create DockerHub Repository and Token

Log in to DockerHub:

1. Create a repository:
   Name it:

```
studybuddy
```

2. Go to **Account Settings â†’ Personal Access Tokens**
3. Create a token named:

```
llmops-token
```

Permissions: **Read, Write, Delete**

## ğŸ” 1ï¸âƒ£5ï¸âƒ£ Add DockerHub Credentials to Jenkins

Go to:

**Manage Jenkins â†’ Credentials â†’ global â†’ Add Credentials**

* Username: DockerHub username
* Password: personal access token
* ID: `dockerhub-token`
* Description: `dockerhub-token`

Save.

## ğŸ“ 1ï¸âƒ£6ï¸âƒ£ Update Jenkinsfile for Docker Builds

Uncomment the environment block:

```groovy
environment {
    DOCKER_HUB_REPO = "ch3rrypi3/studybuddy"
    DOCKER_HUB_CREDENTIALS_ID = "dockerhub-token"
    IMAGE_TAG = "v${BUILD_NUMBER}"
}
```

Update with your actual repo details.

Then uncomment:

```groovy
stage('Build Docker Image') {
    steps {
        script {
            echo 'Building Docker image...'
            dockerImage = docker.build("${DOCKER_HUB_REPO}:${IMAGE_TAG}")
        }
    }
}

stage('Push Image to DockerHub') {
    steps {
        script {
            echo 'Pushing Docker image to DockerHub...'
            docker.withRegistry('https://registry.hub.docker.com', "${DOCKER_HUB_CREDENTIALS_ID}") {
                dockerImage.push("${IMAGE_TAG}")
            }
        }
    }
}
```

Commit and push your updated Jenkinsfile:

```bash
git add .
git commit -m "Enabled Docker build and push stages"
git push
```

On your VM:

```bash
git pull
```

## â˜¸ï¸ 1ï¸âƒ£7ï¸âƒ£ Update Kubernetes Deployment

Open:

```
manifests/deployment.yaml
```

Replace line:

```
image: ch3rrypi3/studybuddy:latest
```

with your own repo and tag format (or keep `latest`).

Push your changes:

```bash
git add .
git commit -m "Updated deployment image"
git push
```

Pull on VM:

```bash
git pull
```

## ğŸš€ 1ï¸âƒ£8ï¸âƒ£ Re-run Jenkins Pipeline

Go back to Jenkins and click:

**Build Now**

If successful, your new Docker image will appear in DockerHub â†’ your repository â†’ tags.